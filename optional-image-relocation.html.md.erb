---
title: Configuring Your System Image Registry
owner: Tanzu Application Service Release Engineering
---

This topic describes how to relocate VMware Tanzu Application Service for Kubernetes 
(TAS for Kubernetes) images to a private container image registry.  

## <a id='overview'></a> Overview

In Kuberenetes, containers can be re-created at various times and the private registry 
must be available if the container is started on a new host. 
You should install TAS for Kubernetes from a private registry
for the following situations:  

* Your deployment has limited network egress because of firewall or network bandwidth.  
* You want to reduce the external runtime dependencies of your TAS for Kubernetes installation. 


<p class="note"><strong>Note</strong>: The following procedure has been validated 
  for the Google Container Registry and for Harbor registries. 
</p>
## <a id='prerequisites'></a> Prerequisites

Before you install TAS for Kubernetes, you must: 

* For installing from the Tanzu Network, you must:  

    * Install the Docker CLI   
    * Complete the procedures in [Preparing to Install Tanzu Application Service for Kubernetes](preparing-to-install-tas-for-kubernetes.html) 
    and [Configuring Installation Values for Tanzu Application Service for Kubernetes]
    (configuring-installation-values.html) 

* For installing from a private registry, you must:  

    * Install the Docker CLI  
    * Grant write access to your private container image registry  
    * Complete the procedures in [Preparing to Install Tanzu Application Service for Kubernetes](preparing-to-install-tas-for-kubernetes.html) 
    and [Configuring Installation Values for Tanzu Application Service for Kubernetes]
    (configuring-installation-values.html)  

## <a id='configure-for-tanzu-network'></a> Configure the Tanzu Network as Your System Registry

### <a id='configure-system-registry-values'></a>Configure Tanzu Network Account Credentials

Tanzu Application Service for Kubernetes requires a registered 
[Tanzu Network](https://network.pivotal.io) account to pull container images for 
system components from the [Tanzu Network container registry](https://registry.pivotal.io/).

To configure Tanzu Application Service for Kubernetes with Tanzu Network user credentials:

1. Change directory into the `configuration-values` directory you created earlier.

1. Create a file named `system-registry-values.yml` in the `configuration-values` directory.  
1. Populate the `system-registry-values.yml` file with the following:

    ```yaml
    #@data/values
    ---
    system_registry:
      hostname: registry.pivotal.io
      username: "USERNAME"
      password: "PASSWORD"
    ```

    Where:
    * `USERNAME` is the username of the account to use to download 
    container images from the Tanzu Network Registry. 
    Ensure this account has a signed Tanzu Application Service for Kubernetes EULA.
    * `PASSWORD` is the password for the account you specified.  

    <p class="note"><strong>Note:</strong> VMware recommends you 
      provide the Tanzu Network account credentials you used to download 
      Tanzu Application Service for Kubernetes.
    </p>

## <a id='configure-for-private'></a> Configure a Private Registry as Your System Registry

### <a id='relocate-tas-for-k8s-images'></a> Relocate TAS for Kubernetes Images

Before you install TAS for Kubernetes from a private registry, 
you have to relocate the image from the Tanzu Network Registry to the private registry:  

* [Download the TAS for Kubernetes Images](#downloading-the-images)
* [Upload the TAS for Kubernetes Images to the Private Registry](#uploading-the-images)

#### <a id='downloading-the-images'></a> Download the TAS for Kubernetes Images

To download the TAS for Kubernetes Images from Tanzu Network Registry:

1. In your terminal, navigate to the `tanzu-application-service` directory.

1. Log in to the Tanzu Network Registry.

    ```
    docker login registry.pivotal.io \
                       -u USERNAME \
                       -p PASSWORD
    ```

    Where:
    * `USERNAME` is a Tanzu Network user account. 
    * `PASSWORD` is the password for the Tanzu Network user account. 

1. Package the images into a tarball.  

    ```
    kbld package -f <(ytt \
                   -f config/image_overrides.yml \
                   -f config/values.yml ) \
                   --output /tmp/images.tar
    ```

    Packaging the image takes about 5 minutes to complete.

#### <a id='uploading-the-images'></a> Upload the TAS for Kubernetes Images to the Private Registry

To upload the TAS for Kubernetes images to the private registry:

1. Log in to the private registry.  

    ```
    docker login registry.SYSTEM-DOMAIN/ORG-NAME/REPOSITORY \
                       -u USERNAME \
                       -p PASSWORD
    ```

    Where:
    * Where `SYSTEM-DOMAIN` is the system domain, such as `example.com`, that you previously selected for your 
    TAS for Kubernetes installation.
    * `ORG-NAME` is your organization name, such as a Cloud Foundry Org name.
    * `REPOSITORY` is the private registry repository to log in to.
    * `USERNAME` is a user account with write access to the private registry. 
    * `PASSWORD` is the password for the user account. 

1. Unpackage the image tarball and upload to the private registry.  
    * If your client has the private registry CA certificates:  

        ```
        kbld unpackage -f <(ytt -f config/image_overrides.yml \
                         -f config/values.yml) \
                         -i /tmp/images.tar \
                         -r registry.SYSTEM-DOMAIN/ORG-NAME/REPOSITORY \
                         --lock-output relocated_images.yml
        ```

        Where:
        * Where `SYSTEM-DOMAIN` is the system domain, such as `example.com`, that you previously selected for your 
        TAS for Kubernetes installation.
        * `ORG-NAME` is your organization name, such as a Cloud Foundry Org name.
        * `REPOSITORY` is the private registry repository to log in to.  
<br>
    * If your client does not have the private registry CA certificates:  

        ```
        kbld unpackage -f <(ytt -f config/image_overrides.yml \
                         -f config/values.yml) \
                         -i /tmp/images.tar \
                         -r registry.SYSTEM-DOMAIN/ORG-NAME/REPOSITORY \
                         --lock-output relocated_images.yml \
                         --registry-verify-certs=false
        ```

        Where:
        * Where `SYSTEM-DOMAIN` is the system domain, such as `example.com`, that you previously selected for your 
        TAS for Kubernetes installation.
        * `ORG-NAME` is your organization name, such as a Cloud Foundry Org name.
        * `REPOSITORY` is the private registry repository to log in to.  

### <a id='configure-for-private-registry'></a> Customize Your Configuration for Your Private System Registry

To customize your configuration files for your private registry: 

1. Move the `config/image_overrides.yml` file out of the `config/` directory.
1. To point the system registry variables to the private registry, 
modify the `configuration-values/system-registry-values.yml` as follows:

    ```
    #@data/values
    ---
    system_registry:
      hostname: "REGISTRY-HOSTNAME"
      username: "REGISTRY-USERNAME"
      password: "REGISTRY-PASSWORD"
    ```

    Where:
    * `REGISTRY-HOSTNAME` is the hostname of your private registry.
    * `REGISTRY-USERNAME` is a user account with write access to the private registry. 
    * `REGISTRY-PASSWORD` is the password for the user account.  
